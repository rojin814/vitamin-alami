import React, { useState, useEffect } from 'react';
import { Plus, Bell, Info, Clock, Pill, Sun, Coffee, Moon, X, Check, Trash2, Edit3, AlertCircle } from 'lucide-react';

const VitaminAlarmApp = () => {
  const [currentView, setCurrentView] = useState('home');
  const [vitamins, setVitamins] = useState([
    {
      id: 1,
      name: 'ë¹„íƒ€ë¯¼ C',
      category: 'ë©´ì—­ë ¥',
      timeSlot: 'ì•„ì¹¨',
      alarmTime: '08:00',
      dosage: '1000mg',
      taken: false,
      info: 'ë©´ì—­ë ¥ ê°•í™”ì™€ í”¼ë¶€ ê±´ê°•ì— ë„ì›€ì„ ì¤ë‹ˆë‹¤.',
      isCustom: false
    },
    {
      id: 2,
      name: 'ë¹„íƒ€ë¯¼ D',
      category: 'ë¼ˆ ê±´ê°•',
      timeSlot: 'ì•„ì¹¨',
      alarmTime: '08:30',
      dosage: '1000IU',
      taken: true,
      info: 'ë¼ˆ ê±´ê°•ê³¼ ì¹¼ìŠ˜ í¡ìˆ˜ë¥¼ ë„ì™€ì¤ë‹ˆë‹¤.',
      isCustom: false
    }
  ]);

  const [showTimeModal, setShowTimeModal] = useState(false);
  const [showTimeSlotModal, setShowTimeSlotModal] = useState(false);
  const [showEditModal, setShowEditModal] = useState(false);
  const [showCustomModal, setShowCustomModal] = useState(false);
  const [showAlarmModal, setShowAlarmModal] = useState(false);
  const [selectedVitaminId, setSelectedVitaminId] = useState(null);
  const [selectedTime, setSelectedTime] = useState('08:00');
  const [selectedVitaminForTimeSlot, setSelectedVitaminForTimeSlot] = useState('');
  const [selectedTimeSlot, setSelectedTimeSlot] = useState('');
  
  // í¸ì§‘/ì»¤ìŠ¤í…€ ëª¨ë‹¬ìš© ìƒíƒœ
  const [editingVitamin, setEditingVitamin] = useState({
    name: '',
    dosage: '',
    info: '',
    category: 'ì‚¬ìš©ì ì •ì˜'
  });

  // ì•ŒëŒ ìƒíƒœ
  const [currentAlarm, setCurrentAlarm] = useState(null);
  const [alarmAudio, setAlarmAudio] = useState(null);

  const extendedCategories = [
    { 
      name: 'ë©´ì—­ë ¥', 
      items: [
        { name: 'ë¹„íƒ€ë¯¼ C', dosage: '1000mg', info: 'ê°•ë ¥í•œ í•­ì‚°í™”ì œë¡œ ë©´ì—­ë ¥ ê°•í™”ì— ë„ì›€' },
        { name: 'ì•„ì—°', dosage: '15mg', info: 'ë©´ì—­ ì„¸í¬ í™œì„±í™”ì™€ ìƒì²˜ ì¹˜ìœ ì— ë„ì›€' },
        { name: 'ì…€ë ˆëŠ„', dosage: '200mcg', info: 'í•­ì‚°í™” ì‘ìš©ìœ¼ë¡œ ì„¸í¬ ë³´í˜¸' },
        { name: 'ì—í‚¤ë„¤ì‹œì•„', dosage: '400mg', info: 'ìì—° ë©´ì—­ë ¥ ê°•í™” í—ˆë¸Œ' },
        { name: 'í”„ë¡œí´ë¦¬ìŠ¤', dosage: '500mg', info: 'ì²œì—° í•­ê· , í•­ì—¼ íš¨ê³¼' }
      ]
    },
    { 
      name: 'ë¼ˆ ê±´ê°•', 
      items: [
        { name: 'ë¹„íƒ€ë¯¼ D', dosage: '1000IU', info: 'ì¹¼ìŠ˜ í¡ìˆ˜ìœ¨ í–¥ìƒìœ¼ë¡œ ë¼ˆ ê±´ê°• ì¦ì§„' },
        { name: 'ì¹¼ìŠ˜', dosage: '600mg', info: 'ë¼ˆì™€ ì¹˜ì•„ êµ¬ì¡°ì˜ ì£¼ìš” ì„±ë¶„' },
        { name: 'ë§ˆê·¸ë„¤ìŠ˜', dosage: '400mg', info: 'ë¼ˆ í˜•ì„±ê³¼ ê·¼ìœ¡ ê¸°ëŠ¥ì— í•„ìˆ˜' },
        { name: 'ë¹„íƒ€ë¯¼ K2', dosage: '100mcg', info: 'ì¹¼ìŠ˜ì„ ë¼ˆë¡œ ìš´ë°˜í•˜ëŠ” ì—­í• ' },
        { name: 'ì½œë¼ê²', dosage: '10g', info: 'ë¼ˆ, ì—°ê³¨, í”¼ë¶€ êµ¬ì¡° ì§€ì›' }
      ]
    },
    { 
      name: 'ì‹¬í˜ˆê´€', 
      items: [
        { name: 'ì˜¤ë©”ê°€3', dosage: '1000mg', info: 'í˜ˆê´€ ê±´ê°•ê³¼ ë‡Œ ê¸°ëŠ¥ ê°œì„ ' },
        { name: 'ì½”ì—”ìì„Q10', dosage: '100mg', info: 'ì‹¬ì¥ ê·¼ìœ¡ ì—ë„ˆì§€ ìƒì„± ì§€ì›' },
        { name: 'ë¹„íƒ€ë¯¼ E', dosage: '400IU', info: 'í˜ˆê´€ ë³´í˜¸ í•­ì‚°í™” ì‘ìš©' },
        { name: 'ë§ˆê·¸ë„¤ìŠ˜', dosage: '400mg', info: 'í˜ˆì•• ì¡°ì ˆê³¼ ì‹¬ì¥ ë¦¬ë“¬ ì•ˆì •' },
        { name: 'ë ˆë“œ ì´ìŠ¤íŠ¸ ë¼ì´ìŠ¤', dosage: '600mg', info: 'ì½œë ˆìŠ¤í…Œë¡¤ ìˆ˜ì¹˜ ê´€ë¦¬' }
      ]
    },
    { 
      name: 'ì—ë„ˆì§€', 
      items: [
        { name: 'ë¹„íƒ€ë¯¼ Bë³µí•©ì²´', dosage: '50mg', info: 'ì—ë„ˆì§€ ëŒ€ì‚¬ì™€ ì‹ ê²½ ê¸°ëŠ¥ ì§€ì›' },
        { name: 'ì² ë¶„', dosage: '18mg', info: 'ì‚°ì†Œ ìš´ë°˜ê³¼ ì—ë„ˆì§€ ìƒì„±' },
        { name: 'ì—½ì‚°', dosage: '400mcg', info: 'ì„¸í¬ ë¶„ì—´ê³¼ DNA í•©ì„±' },
        { name: 'ë¹„íƒ€ë¯¼ B12', dosage: '1000mcg', info: 'ì‹ ê²½ ê¸°ëŠ¥ê³¼ ì í˜ˆêµ¬ ìƒì„±' },
        { name: 'ë¡œë””ì˜¬ë¼', dosage: '300mg', info: 'ìŠ¤íŠ¸ë ˆìŠ¤ ì €í•­ë ¥ê³¼ í”¼ë¡œ ê°œì„ ' }
      ]
    },
    { 
      name: 'í”¼ë¶€', 
      items: [
        { name: 'ì½œë¼ê²', dosage: '10g', info: 'í”¼ë¶€ íƒ„ë ¥ê³¼ ìˆ˜ë¶„ ê³µê¸‰' },
        { name: 'ë¹„ì˜¤í‹´', dosage: '5000mcg', info: 'ëª¨ë°œ, í”¼ë¶€, ì†í†± ê±´ê°•' },
        { name: 'ë¹„íƒ€ë¯¼ A', dosage: '5000IU', info: 'í”¼ë¶€ ì¬ìƒê³¼ ì‹œë ¥ ë³´í˜¸' },
        { name: 'íˆì•Œë£¨ë¡ ì‚°', dosage: '150mg', info: 'í”¼ë¶€ ìˆ˜ë¶„ ë³´ìœ ë ¥ í–¥ìƒ' },
        { name: 'ê¸€ë£¨íƒ€ì¹˜ì˜¨', dosage: '250mg', info: 'í”¼ë¶€ ë¯¸ë°±ê³¼ í•´ë… ì‘ìš©' }
      ]
    },
    { 
      name: 'ì†Œí™”', 
      items: [
        { name: 'í”„ë¡œë°”ì´ì˜¤í‹±ìŠ¤', dosage: '10ì–µ CFU', info: 'ì¥ë‚´ ìœ ìµê·  ì¦ì‹ìœ¼ë¡œ ì†Œí™” ê°œì„ ' },
        { name: 'ì†Œí™”íš¨ì†Œ', dosage: '500mg', info: 'ìŒì‹ë¬¼ ë¶„í•´ì™€ ì˜ì–‘ì†Œ í¡ìˆ˜' },
        { name: 'ê¸€ë£¨íƒ€ë¯¼', dosage: '5g', info: 'ì¥ ì ë§‰ íšŒë³µê³¼ ë©´ì—­ë ¥ ê°•í™”' },
        { name: 'ìƒê°• ì¶”ì¶œë¬¼', dosage: '250mg', info: 'ì†Œí™” ì´‰ì§„ê³¼ ë©”ìŠ¤êº¼ì›€ ì™„í™”' },
        { name: 'í˜í¼ë¯¼íŠ¸', dosage: '200mg', info: 'ì†Œí™” ë¶ˆëŸ‰ê³¼ ë³µë¶€ íŒ½ë§Œê° ì™„í™”' }
      ]
    }
  ];

  const timeSlots = [
    { id: 'morning', name: 'ì•„ì¹¨', icon: Sun, color: 'from-yellow-400 to-orange-500' },
    { id: 'lunch', name: 'ì ì‹¬', icon: Coffee, color: 'from-blue-400 to-indigo-500' },
    { id: 'evening', name: 'ì €ë…', icon: Moon, color: 'from-purple-400 to-pink-500' }
  ];

  // ì•ŒëŒ ì²´í¬ (ì‹¤ì œ ì•±ì—ì„œëŠ” ë°±ê·¸ë¼ìš´ë“œ ì„œë¹„ìŠ¤ ì‚¬ìš©)
  useEffect(() => {
    const checkAlarms = () => {
      const now = new Date();
      const currentTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
      
      const alarmVitamin = vitamins.find(vitamin => 
        vitamin.alarmTime === currentTime && !vitamin.taken
      );
      
      if (alarmVitamin && !currentAlarm) {
        triggerAlarm(alarmVitamin);
      }
    };

    const interval = setInterval(checkAlarms, 60000); // 1ë¶„ë§ˆë‹¤ ì²´í¬
    return () => clearInterval(interval);
  }, [vitamins, currentAlarm]);

  const triggerAlarm = (vitamin) => {
    setCurrentAlarm(vitamin);
    setShowAlarmModal(true);
    
    // ì•ŒëŒ ì†Œë¦¬ (ì‹¤ì œ ì•±ì—ì„œëŠ” ë„¤ì´í‹°ë¸Œ ì•Œë¦¼ ì‚¬ìš´ë“œ ì‚¬ìš©)
    const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvWEcBDuO1fPQgC0FJnDC7+OWRQ0RUp3e8bllHgg+itfzzH4vBSF4w+/glUcDEJeUjYyMj5+PjYyNnIyMjZ');
    audio.loop = true;
    audio.play().catch(() => {
      // ë¸Œë¼ìš°ì €ì—ì„œ ìë™ ì¬ìƒì´ ì°¨ë‹¨ëœ ê²½ìš°
      console.log('ì˜¤ë””ì˜¤ ì¬ìƒì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.');
    });
    setAlarmAudio(audio);
  };

  const dismissAlarm = () => {
    if (alarmAudio) {
      alarmAudio.pause();
      alarmAudio.currentTime = 0;
      setAlarmAudio(null);
    }
    setCurrentAlarm(null);
    setShowAlarmModal(false);
  };

  const toggleVitaminTaken = (id) => {
    setVitamins(vitamins.map(vitamin => 
      vitamin.id === id ? { ...vitamin, taken: !vitamin.taken } : vitamin
    ));
  };

  const openTimeModal = (vitaminId, currentTime) => {
    setSelectedVitaminId(vitaminId);
    setSelectedTime(currentTime);
    setShowTimeModal(true);
  };

  const confirmTimeChange = () => {
    setVitamins(vitamins.map(vitamin => 
      vitamin.id === selectedVitaminId 
        ? { ...vitamin, alarmTime: selectedTime }
        : vitamin
    ));
    setShowTimeModal(false);
    setSelectedVitaminId(null);
  };

  const cancelTimeChange = () => {
    setShowTimeModal(false);
    setSelectedVitaminId(null);
  };

  const openEditModal = (item) => {
    setEditingVitamin({
      name: item.name,
      dosage: item.dosage,
      info: item.info,
      category: extendedCategories.find(cat => 
        cat.items.some(catItem => catItem.name === item.name)
      )?.name || 'ê¸°íƒ€'
    });
    setSelectedVitaminForTimeSlot(item.name);
    setShowEditModal(true);
  };

  const openCustomModal = () => {
    setEditingVitamin({
      name: '',
      dosage: '',
      info: '',
      category: 'ì‚¬ìš©ì ì •ì˜'
    });
    setShowCustomModal(true);
  };

  const confirmEdit = () => {
    setSelectedVitaminForTimeSlot(editingVitamin.name);
    setShowEditModal(false);
    setShowTimeSlotModal(true);
  };

  const confirmCustom = () => {
    if (editingVitamin.name.trim()) {
      setSelectedVitaminForTimeSlot(editingVitamin.name);
      setShowCustomModal(false);
      setShowTimeSlotModal(true);
    }
  };

  const cancelEdit = () => {
    setShowEditModal(false);
    setEditingVitamin({ name: '', dosage: '', info: '', category: 'ì‚¬ìš©ì ì •ì˜' });
  };

  const cancelCustom = () => {
    setShowCustomModal(false);
    setEditingVitamin({ name: '', dosage: '', info: '', category: 'ì‚¬ìš©ì ì •ì˜' });
  };

  const openTimeSlotModal = (vitaminName) => {
    setSelectedVitaminForTimeSlot(vitaminName);
    setShowTimeSlotModal(true);
  };

  const confirmTimeSlotSelection = () => {
    if (selectedTimeSlot && selectedVitaminForTimeSlot) {
      let vitaminInfo;
      
      if (editingVitamin.name) {
        // í¸ì§‘ëœ ë˜ëŠ” ì»¤ìŠ¤í…€ ë¹„íƒ€ë¯¼
        vitaminInfo = {
          name: editingVitamin.name,
          dosage: editingVitamin.dosage,
          info: editingVitamin.info,
          category: editingVitamin.category
        };
      } else {
        // ê¸°ë³¸ ë¹„íƒ€ë¯¼
        vitaminInfo = extendedCategories
          .flatMap(cat => cat.items)
          .find(item => item.name === selectedVitaminForTimeSlot);
      }
      
      const newVitamin = {
        id: Date.now(),
        name: vitaminInfo.name,
        category: vitaminInfo.category || editingVitamin.category,
        timeSlot: selectedTimeSlot,
        alarmTime: '08:00',
        dosage: vitaminInfo.dosage,
        taken: false,
        info: vitaminInfo.info,
        isCustom: editingVitamin.name !== ''
      };
      
      setVitamins([...vitamins, newVitamin]);
      setShowTimeSlotModal(false);
      setSelectedVitaminForTimeSlot('');
      setSelectedTimeSlot('');
      setEditingVitamin({ name: '', dosage: '', info: '', category: 'ì‚¬ìš©ì ì •ì˜' });
      setCurrentView('home');
    }
  };

  const cancelTimeSlotSelection = () => {
    setShowTimeSlotModal(false);
    setSelectedVitaminForTimeSlot('');
    setSelectedTimeSlot('');
    setEditingVitamin({ name: '', dosage: '', info: '', category: 'ì‚¬ìš©ì ì •ì˜' });
  };

  const deleteVitamin = (id) => {
    setVitamins(vitamins.filter(vitamin => vitamin.id !== id));
  };

  const renderHome = () => (
    <div className="space-y-6">
      <div className="text-center py-6">
        <h1 className="text-3xl font-bold text-green-600 mb-2">ë¹„íƒ€ë¯¼ ì•Œë¼ë¯¸</h1>
        <p className="text-gray-600">ì˜¤ëŠ˜ì˜ ë¹„íƒ€ë¯¼ ì¼ì •ì„ í™•ì¸í•˜ì„¸ìš”</p>
      </div>

      <div className="bg-gradient-to-r from-green-400 to-blue-500 rounded-xl p-6 text-white">
        <h2 className="text-xl font-semibold mb-4">ì˜¤ëŠ˜ì˜ ë³µìš© í˜„í™©</h2>
        <div className="flex justify-between items-center">
          <div className="text-center">
            <div className="text-2xl font-bold">{vitamins.filter(v => v.taken).length}</div>
            <div className="text-sm opacity-90">ë³µìš© ì™„ë£Œ</div>
          </div>
          <div className="text-center">
            <div className="text-2xl font-bold">{vitamins.length}</div>
            <div className="text-sm opacity-90">ì´ í•­ëª©</div>
          </div>
          <div className="text-center">
            <div className="text-2xl font-bold">
              {vitamins.length > 0 ? Math.round((vitamins.filter(v => v.taken).length / vitamins.length) * 100) : 0}%
            </div>
            <div className="text-sm opacity-90">ë‹¬ì„±ë¥ </div>
          </div>
        </div>
      </div>

      <div className="space-y-4">
        {timeSlots.map(slot => {
          const timeVitamins = vitamins.filter(v => v.timeSlot === slot.name);
          
          if (timeVitamins.length === 0) return null;
          
          const IconComponent = slot.icon;
          
          return (
            <div key={slot.id} className="bg-white rounded-xl shadow-lg overflow-hidden">
              <div className={`bg-gradient-to-r ${slot.color} p-4`}>
                <div className="flex items-center text-white">
                  <IconComponent className="w-6 h-6 mr-3" />
                  <h4 className="font-bold text-lg">{slot.name}</h4>
                  <span className="ml-auto text-sm opacity-90">
                    {timeVitamins.length}ê°œ í•­ëª©
                  </span>
                </div>
              </div>
              
              <div className="p-4 space-y-3">
                {timeVitamins.map((vitamin, index) => (
                  <div 
                    key={vitamin.id} 
                    className={`transition-all duration-300 ease-in-out transform ${
                      vitamin.taken 
                        ? 'bg-green-50 border-2 border-green-200' 
                        : 'bg-gray-50 border-2 border-gray-200 hover:border-gray-300'
                    } rounded-lg p-4 cursor-pointer`}
                    onClick={() => toggleVitaminTaken(vitamin.id)}
                    style={{
                      animationDelay: `${index * 100}ms`,
                      animation: 'slideInUp 0.5s ease-out forwards'
                    }}
                  >
                    <div className="flex items-center justify-between">
                      <div className="flex items-center space-x-4">
                        <Pill className={`w-6 h-6 transition-colors duration-300 ${
                          vitamin.taken ? 'text-green-500' : 'text-gray-400'
                        }`} />
                        <div className="flex-1">
                          <div className={`font-semibold transition-colors duration-300 flex items-center ${
                            vitamin.taken ? 'text-green-800' : 'text-gray-800'
                          }`}>
                            {vitamin.name}
                            {vitamin.isCustom && (
                              <span className="ml-2 px-2 py-1 bg-purple-100 text-purple-600 text-xs rounded-full">
                                ì‚¬ìš©ì ì •ì˜
                              </span>
                            )}
                          </div>
                          <div className="text-sm text-gray-500">
                            {vitamin.dosage}
                          </div>
                        </div>
                      </div>
                      
                      <div className="flex items-center space-x-3">
                        <button
                          onClick={(e) => {
                            e.stopPropagation();
                            openTimeModal(vitamin.id, vitamin.alarmTime);
                          }}
                          className="flex items-center space-x-1 px-3 py-2 bg-blue-100 hover:bg-blue-200 rounded-lg transition-colors"
                        >
                          <Clock className="w-4 h-4 text-blue-600" />
                          <span className="text-sm font-medium text-blue-600">
                            {vitamin.alarmTime}
                          </span>
                        </button>
                        
                        <button
                          onClick={(e) => {
                            e.stopPropagation();
                            deleteVitamin(vitamin.id);
                          }}
                          className="p-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                        >
                          <Trash2 className="w-4 h-4" />
                        </button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          );
        })}
        
        {vitamins.length === 0 && (
          <div className="text-center py-12">
            <Pill className="w-16 h-16 text-gray-300 mx-auto mb-4" />
            <h3 className="text-lg font-semibold text-gray-600 mb-2">
              ì•„ì§ ë“±ë¡ëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤
            </h3>
            <p className="text-gray-500 mb-6">
              'ì¶”ê°€' íƒ­ì—ì„œ ë¹„íƒ€ë¯¼ì´ë‚˜ ì•½ì„ ë“±ë¡í•´ë³´ì„¸ìš”
            </p>
            <button
              onClick={() => setCurrentView('add')}
              className="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
            >
              í•­ëª© ì¶”ê°€í•˜ê¸°
            </button>
          </div>
        )}
      </div>

      <style jsx>{`
        @keyframes slideInUp {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
      `}</style>
    </div>
  );

  const renderAddVitamin = () => (
    <div className="space-y-6">
      <div className="text-center py-4">
        <h2 className="text-2xl font-bold text-gray-800">í•­ëª© ì¶”ê°€</h2>
        <p className="text-gray-600">ë¹„íƒ€ë¯¼ì´ë‚˜ ì•½ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”</p>
      </div>

      {/* ì‚¬ìš©ì ì •ì˜ ì¶”ê°€ */}
      <div className="bg-gradient-to-r from-purple-400 to-pink-500 rounded-xl shadow-lg overflow-hidden">
        <div className="p-4">
          <h3 className="font-bold text-white text-lg mb-2">ë‚˜ë§Œì˜ í•­ëª© ì¶”ê°€</h3>
          <p className="text-white opacity-90 text-sm mb-4">
            ë¹„íƒ€ë¯¼, ì•½, ê±´ê°•ë³´ì¡°ì‹í’ˆ ë“±ì„ ì§ì ‘ ì¶”ê°€í•  ìˆ˜ ìˆì–´ìš”
          </p>
          <button
            onClick={openCustomModal}
            className="w-full p-4 bg-white bg-opacity-20 hover:bg-opacity-30 text-white rounded-lg transition-all flex items-center justify-center space-x-2"
          >
            <Plus className="w-5 h-5" />
            <span className="font-medium">ì§ì ‘ ì¶”ê°€í•˜ê¸°</span>
          </button>
        </div>
      </div>

      {/* ê¸°ë³¸ ë¹„íƒ€ë¯¼ ì¹´í…Œê³ ë¦¬ */}
      <div className="space-y-4">
        <h3 className="text-lg font-semibold text-gray-800">ì¶”ì²œ ë¹„íƒ€ë¯¼</h3>
        
        {extendedCategories.map(category => (
          <div key={category.name} className="bg-white rounded-xl shadow-lg overflow-hidden">
            <div className="bg-gradient-to-r from-green-400 to-blue-500 p-4">
              <h3 className="font-bold text-white text-lg">{category.name}</h3>
              <p className="text-white opacity-90 text-sm">{category.items.length}ê°œ í•­ëª©</p>
            </div>
            
            <div className="p-4 space-y-2">
              {category.items.map(item => (
                <div
                  key={item.name}
                  className="flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors group"
                >
                  <div className="flex-1">
                    <div className="font-semibold text-gray-800">{item.name}</div>
                    <div className="text-sm text-green-600 font-medium">{item.dosage}</div>
                    <div className="text-xs text-gray-500 mt-1">{item.info}</div>
                  </div>
                  <div className="flex space-x-2">
                    <button
                      onClick={() => openEditModal(item)}
                      className="p-2 bg-blue-500 hover:bg-blue-600 text-white rounded-full transition-colors"
                      title="ìˆ˜ì •í•˜ê¸°"
                    >
                      <Edit3 className="w-4 h-4" />
                    </button>
                    <button
                      onClick={() => openTimeSlotModal(item.name)}
                      className="p-2 bg-green-500 hover:bg-green-600 text-white rounded-full transition-colors group-hover:scale-110 transform duration-200"
                      title="ë°”ë¡œ ì¶”ê°€"
                    >
                      <Plus className="w-4 h-4" />
                    </button>
                  </div>
                </div>
              ))}
            </div>
          </div>
        ))}
      </div>

      <div className="bg-green-50 rounded-xl p-6">
        <h4 className="font-bold text-green-800 mb-3 flex items-center">
          <Info className="w-5 h-5 mr-2" />
          ë³µìš© ê°€ì´ë“œ
        </h4>
        <div className="space-y-2 text-sm text-green-700">
          <p>â€¢ <strong>ì•„ì¹¨</strong>: ì§€ìš©ì„± ë¹„íƒ€ë¯¼(A, D, E, K)ì€ ì‹í›„ ë³µìš©</p>
          <p>â€¢ <strong>ì ì‹¬</strong>: ë¹„íƒ€ë¯¼ Bêµ°ì€ ì—ë„ˆì§€ ëŒ€ì‚¬ì— ë„ì›€</p>
          <p>â€¢ <strong>ì €ë…</strong>: ë§ˆê·¸ë„¤ìŠ˜, ì¹¼ìŠ˜ì€ ìˆ˜ë©´ ì „ ë³µìš© ê¶Œì¥</p>
        </div>
      </div>
    </div>
  );

  const renderInfo = () => (
    <div className="space-y-6">
      <div className="text-center py-4">
        <h2 className="text-2xl font-bold text-gray-800">ë‚˜ì˜ í•­ëª©</h2>
        <p className="text-gray-600">ë“±ë¡ëœ í•­ëª© ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
      </div>

      {vitamins.length > 0 ? (
        <div className="space-y-4">
          {vitamins.map(vitamin => (
            <div key={vitamin.id} className="bg-white rounded-xl shadow-lg p-6">
              <div className="flex items-start justify-between mb-4">
                <div>
                  <div className="flex items-center space-x-2 mb-2">
                    <h3 className="font-bold text-gray-800 text-lg">{vitamin.name}</h3>
                    {vitamin.isCustom && (
                      <span className="px-2 py-1 bg-purple-100 text-purple-600 text-xs rounded-full">
                        ì‚¬ìš©ì ì •ì˜
                      </span>
                    )}
                  </div>
                  <div className="flex items-center space-x-2 mt-2">
                    <span className="inline-block px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full">
                      {vitamin.category}
                    </span>
                    <span className="inline-block px-3 py-1 bg-green-100 text-green-800 text-sm rounded-full">
                      {vitamin.timeSlot}
                    </span>
                  </div>
                </div>
                <div className="text-right text-sm text-gray-500">
                  <div className="font-medium">{vitamin.dosage}</div>
                  <div className="flex items-center mt-1">
                    <Clock className="w-4 h-4 mr-1" />
                    {vitamin.alarmTime}
                  </div>
                </div>
              </div>
              <p className="text-gray-600 leading-relaxed bg-gray-50 p-4 rounded-lg">
                {vitamin.info}
              </p>
            </div>
          ))}
        </div>
      ) : (
        <div className="text-center py-12">
          <Info className="w-16 h-16 text-gray-300 mx-auto mb-4" />
          <h3 className="text-lg font-semibold text-gray-600 mb-2">
            ë“±ë¡ëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤
          </h3>
          <p className="text-gray-500">
            ë¨¼ì € ë¹„íƒ€ë¯¼ì´ë‚˜ ì•½ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”
          </p>
        </div>
      )}

      <div className="bg-yellow-50 rounded-xl p-6">
        <h4 className="font-bold text-yellow-800 mb-3">âš ï¸ ì£¼ì˜ì‚¬í•­</h4>
        <ul className="text-sm text-yellow-700 space-y-2">
          <li>â€¢ ë¹„íƒ€ë¯¼ ê³¼ë‹¤ ë³µìš©ì€ ë¶€ì‘ìš©ì„ ì¼ìœ¼í‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
          <li>â€¢ ë³µìš© ì „ ì˜ì‚¬ë‚˜ ì•½ì‚¬ì™€ ìƒë‹´í•˜ì„¸ìš”</li>
          <li>â€¢ ë‹¤ë¥¸ ì•½ë¬¼ê³¼ì˜ ìƒí˜¸ì‘ìš©ì„ í™•ì¸í•˜ì„¸ìš”</li>
          <li>â€¢ ì„ì‹ , ìˆ˜ìœ  ì¤‘ì¸ ê²½ìš° ì „ë¬¸ì˜ì™€ ìƒë‹´ í•„ìˆ˜</li>
        </ul>
      </div>
    </div>
  );

  return (
    <div className="max-w-md mx-auto bg-gray-100 min-h-screen relative">
      <div className="p-4 pb-20">
        {currentView === 'home' && renderHome()}
        {currentView === 'add' && renderAddVitamin()}
        {currentView === 'info' && renderInfo()}
      </div>

      {/* ì‹œê°„ ì„¤ì • ëª¨ë‹¬ */}
      {showTimeModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl p-6 w-full max-w-sm">
            <h3 className="text-lg font-bold text-gray-800 mb-4 text-center">ì•ŒëŒ ì‹œê°„ ì„¤ì •</h3>
            
            <div className="mb-6">
              <input
                type="time"
                value={selectedTime}
                onChange={(e) => setSelectedTime(e.target.value)}
                className="w-full p-4 text-2xl text-center border-2 border-gray-200 rounded-lg focus:border-green-500 focus:outline-none"
              />
            </div>
            
            <div className="flex space-x-3">
              <button
                onClick={cancelTimeChange}
                className="flex-1 py-3 px-4 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium"
              >
                ì·¨ì†Œ
              </button>
              <button
                onClick={confirmTimeChange}
                className="flex-1 py-3 px-4 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors font-medium"
              >
                í™•ì¸
              </button>
            </div>
          </div>
        </div>
      )}

      {/* í•­ëª© í¸ì§‘ ëª¨ë‹¬ */}
      {showEditModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl p-6 w-full max-w-sm max-h-[80vh] overflow-y-auto">
            <h3 className="text-lg font-bold text-gray-800 mb-4 text-center">í•­ëª© í¸ì§‘</h3>
            
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ì´ë¦„</label>
                <input
                  type="text"
                  value={editingVitamin.name}
                  onChange={(e) => setEditingVitamin({...editingVitamin, name: e.target.value})}
                  className="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-green-500 focus:outline-none"
                  placeholder="ë¹„íƒ€ë¯¼ ë˜ëŠ” ì•½ ì´ë¦„"
                />
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">í•¨ëŸ‰</label>
                <input
                  type="text"
                  value={editingVitamin.dosage}
                  onChange={(e) => setEditingVitamin({...editingVitamin, dosage: e.target.value})}
                  className="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-green-500 focus:outline-none"
                  placeholder="ì˜ˆ: 1000mg, 1ì •, 1íšŒ"
                />
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ì„¤ëª…</label>
                <textarea
                  value={editingVitamin.info}
                  onChange={(e) => setEditingVitamin({...editingVitamin, info: e.target.value})}
                  rows={3}
                  className="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-green-500 focus:outline-none resize-none"
                  placeholder="íš¨ëŠ¥ì´ë‚˜ ë³µìš© ëª©ì ì„ ì…ë ¥í•˜ì„¸ìš”"
                />
              </div>
            </div>
            
            <div className="flex space-x-3 mt-6">
              <button
                onClick={cancelEdit}
                className="flex-1 py-3 px-4 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium"
              >
                ì·¨ì†Œ
              </button>
              <button
                onClick={confirmEdit}
                disabled={!editingVitamin.name.trim()}
                className={`flex-1 py-3 px-4 rounded-lg font-medium transition-colors ${
                  editingVitamin.name.trim()
                    ? 'bg-green-500 text-white hover:bg-green-600'
                    : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                }`}
              >
                í™•ì¸
              </button>
            </div>
          </div>
        </div>
      )}

      {/* ì‚¬ìš©ì ì •ì˜ ì¶”ê°€ ëª¨ë‹¬ */}
      {showCustomModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl p-6 w-full max-w-sm max-h-[80vh] overflow-y-auto">
            <h3 className="text-lg font-bold text-gray-800 mb-4 text-center">ì§ì ‘ ì¶”ê°€í•˜ê¸°</h3>
            <p className="text-sm text-gray-600 mb-6 text-center">
              ë¹„íƒ€ë¯¼, ì•½, ê±´ê°•ë³´ì¡°ì‹í’ˆ ë“±ì„ ììœ ë¡­ê²Œ ì¶”ê°€í•˜ì„¸ìš”
            </p>
            
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ì´ë¦„ *</label>
                <input
                  type="text"
                  value={editingVitamin.name}
                  onChange={(e) => setEditingVitamin({...editingVitamin, name: e.target.value})}
                  className="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                  placeholder="ì˜ˆ: ì¢…í•©ë¹„íƒ€ë¯¼, í˜ˆì••ì•½, ì˜¤ë©”ê°€3"
                />
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">í•¨ëŸ‰</label>
                <input
                  type="text"
                  value={editingVitamin.dosage}
                  onChange={(e) => setEditingVitamin({...editingVitamin, dosage: e.target.value})}
                  className="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                  placeholder="ì˜ˆ: 500mg, 1ì •, 1ìº¡ìŠ, 1íšŒ"
                />
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ì„¤ëª…</label>
                <textarea
                  value={editingVitamin.info}
                  onChange={(e) => setEditingVitamin({...editingVitamin, info: e.target.value})}
                  rows={3}
                  className="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none resize-none"
                  placeholder="íš¨ëŠ¥, ë³µìš© ëª©ì , ì£¼ì˜ì‚¬í•­ ë“±ì„ ì…ë ¥í•˜ì„¸ìš”"
                />
              </div>
            </div>
            
            <div className="flex space-x-3 mt-6">
              <button
                onClick={cancelCustom}
                className="flex-1 py-3 px-4 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium"
              >
                ì·¨ì†Œ
              </button>
              <button
                onClick={confirmCustom}
                disabled={!editingVitamin.name.trim()}
                className={`flex-1 py-3 px-4 rounded-lg font-medium transition-colors ${
                  editingVitamin.name.trim()
                    ? 'bg-purple-500 text-white hover:bg-purple-600'
                    : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                }`}
              >
                í™•ì¸
              </button>
            </div>
          </div>
        </div>
      )}

      {/* ì‹œê°„ëŒ€ ì„ íƒ ëª¨ë‹¬ */}
      {showTimeSlotModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl p-6 w-full max-w-sm">
            <h3 className="text-lg font-bold text-gray-800 mb-2 text-center">ì‹œê°„ëŒ€ ì„ íƒ</h3>
            <p className="text-sm text-gray-600 mb-6 text-center">{selectedVitaminForTimeSlot}</p>
            
            <div className="space-y-3 mb-6">
              {timeSlots.map(slot => {
                const IconComponent = slot.icon;
                return (
                  <button
                    key={slot.id}
                    onClick={() => setSelectedTimeSlot(slot.name)}
                    className={`w-full p-4 rounded-lg border-2 transition-all flex items-center ${
                      selectedTimeSlot === slot.name
                        ? 'border-green-500 bg-green-50'
                        : 'border-gray-200 hover:border-gray-300'
                    }`}
                  >
                    <IconComponent className={`w-6 h-6 mr-3 ${
                      selectedTimeSlot === slot.name ? 'text-green-600' : 'text-gray-500'
                    }`} />
                    <span className={`font-medium ${
                      selectedTimeSlot === slot.name ? 'text-green-800' : 'text-gray-700'
                    }`}>
                      {slot.name}
                    </span>
                    {selectedTimeSlot === slot.name && (
                      <Check className="w-5 h-5 text-green-600 ml-auto" />
                    )}
                  </button>
                );
              })}
            </div>
            
            <div className="flex space-x-3">
              <button
                onClick={cancelTimeSlotSelection}
                className="flex-1 py-3 px-4 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium"
              >
                ì·¨ì†Œ
              </button>
              <button
                onClick={confirmTimeSlotSelection}
                disabled={!selectedTimeSlot}
                className={`flex-1 py-3 px-4 rounded-lg font-medium transition-colors ${
                  selectedTimeSlot
                    ? 'bg-green-500 text-white hover:bg-green-600'
                    : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                }`}
              >
                í™•ì¸
              </button>
            </div>
          </div>
        </div>
      )}

      {/* ì•ŒëŒ ëª¨ë‹¬ */}
      {showAlarmModal && currentAlarm && (
        <div className="fixed inset-0 bg-gradient-to-br from-green-400 via-blue-500 to-purple-600 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-3xl p-8 w-full max-w-sm text-center shadow-2xl transform animate-pulse">
            {/* ì• ë‹ˆë©”ì´ì…˜ ë§ */}
            <div className="relative mb-6">
              <div className="w-24 h-24 mx-auto bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center animate-bounce">
                <Pill className="w-12 h-12 text-white" />
              </div>
              <div className="absolute inset-0 w-24 h-24 mx-auto border-4 border-green-300 rounded-full animate-ping"></div>
            </div>
            
            <h2 className="text-2xl font-bold text-gray-800 mb-2">
              ë³µìš© ì‹œê°„ì´ì—ìš”! ğŸ’Š
            </h2>
            
            <div className="bg-gray-50 rounded-xl p-4 mb-6">
              <h3 className="text-xl font-semibold text-green-600 mb-1">
                {currentAlarm.name}
              </h3>
              <p className="text-gray-600 text-sm mb-2">
                {currentAlarm.dosage}
              </p>
              <div className="flex items-center justify-center text-blue-600">
                <Clock className="w-4 h-4 mr-1" />
                <span className="font-medium">{currentAlarm.alarmTime}</span>
              </div>
            </div>
            
            <div className="bg-yellow-50 rounded-lg p-3 mb-6">
              <p className="text-sm text-yellow-700">
                ğŸ’¡ {currentAlarm.info}
              </p>
            </div>
            
            <button
              onClick={dismissAlarm}
              className="w-full py-4 bg-gradient-to-r from-green-500 to-blue-500 text-white text-lg font-bold rounded-xl hover:from-green-600 hover:to-blue-600 transition-all transform hover:scale-105 shadow-lg"
            >
              í™•ì¸
            </button>
            
            <div className="mt-4 flex items-center justify-center text-gray-500 text-sm">
              <AlertCircle className="w-4 h-4 mr-1" />
              <span>ê±´ê°•í•œ í•˜ë£¨ ë˜ì„¸ìš”!</span>
            </div>
          </div>
        </div>
      )}

      {/* Bottom Navigation */}
      <div className="fixed bottom-0 left-1/2 transform -translate-x-1/2 w-full max-w-md bg-white border-t border-gray-200 shadow-lg">
        <div className="flex justify-around py-2">
          <button
            onClick={() => setCurrentView('home')}
            className={`flex flex-col items-center p-3 rounded-lg transition-all duration-200 ${
              currentView === 'home' 
                ? 'text-green-600 bg-green-50 scale-105' 
                : 'text-gray-400 hover:text-gray-600'
            }`}
          >
            <Bell className="w-6 h-6" />
            <span className="text-xs mt-1 font-medium">í™ˆ</span>
          </button>
          
          <button
            onClick={() => setCurrentView('add')}
            className={`flex flex-col items-center p-3 rounded-lg transition-all duration-200 ${
              currentView === 'add' 
                ? 'text-green-600 bg-green-50 scale-105' 
                : 'text-gray-400 hover:text-gray-600'
            }`}
          >
            <Plus className="w-6 h-6" />
            <span className="text-xs mt-1 font-medium">ì¶”ê°€</span>
          </button>
          
          <button
            onClick={() => setCurrentView('info')}
            className={`flex flex-col items-center p-3 rounded-lg transition-all duration-200 ${
              currentView === 'info' 
                ? 'text-green-600 bg-green-50 scale-105' 
                : 'text-gray-400 hover:text-gray-600'
            }`}
          >
            <Info className="w-6 h-6" />
            <span className="text-xs mt-1 font-medium">ì •ë³´</span>
          </button>
        </div>
      </div>
    </div>
  );
};

export default VitaminAlarmApp;